<#bs4Body>

<div class="container-fluid">
    <input type="hidden" id="_sourceChannel" value="<#config name='ia.source.channel.boutiqueEntranceRecord'/>">
    <form id="saveForm" role="form" novalidate>
        <input type="hidden" class="form-control" id="recordId" name="recordId" value="${boutiqueEntranceRecord.id!}"/>
        <input type="hidden" class="form-control" id="endTime" name="endTime"/>
        <div class="row row-cols-2">
        <div class="form-group col">
            <label _log for="plate">挂号<i class="red">*</i></label>
            <input type="text" class="form-control" id="plate" name="plate" value="${boutiqueEntranceRecord.plate!}" readonly />
        </div>

            <div class="form-group col">
                <label for="carTypeId">车型</label>
                <select id="carTypeId"  name="carTypeId" class="form-control" readonly ></select>
                <#bcomboProvider _log="车型" _id="carTypeId" _provider="boutiqueCarTypeProvider" _value="${boutiqueEntranceRecord.carTypeId!}"  />
            </div>

            <div class="form-group col">
                <label _log for="customerName">客户姓名<i class="red">*</i></label>
                <input type="text" class="form-control" id="customerName" name="customerName" value="${boutiqueEntranceRecord.customerName!}"  readonly  />
            </div>

            <div class="form-group col">
                <label _log  for="customerCellphone">联系电话<i class="red">*</i></label>
                <input type="text" class="form-control" id="customerCellphone" name="customerCellphone" value="${boutiqueEntranceRecord.customerCellphone!}"  readonly  />
            </div>

            <div class="form-group col">
                <label for="enterTime">进场时间<i class="red">*</i></label>
                <input type="text" class="form-control" id="enterTime" name="enterTime" value="${boutiqueEntranceRecord.enterTime!,localDateTimeFormat='yyyy-MM-dd HH:mm:ss'}" readonly />
            </div>

            <div class="form-group col">
                <label _log for="confirmTime">确认时间<i class="red">*</i></label>
                <input type="text" class="form-control" id="confirmTime" name="confirmTime" value="${boutiqueEntranceRecord.confirmTime!,localDateTimeFormat='yyyy-MM-dd HH:mm:ss'}" readonly />
            </div>

            <div class="form-group col">
                <label _log for="startTime">开始计费<i class="red">*</i></label>
                <input type="text" class="form-control" id="startTime" name="startTime" value="${boutiqueEntranceRecord.startTime!,localDateTimeFormat='yyyy-MM-dd HH:mm:ss'}" readonly />
            </div>

            <!-- 精品停车的下次计费就是精品停车交费单的开始时间 -->
            <div class="form-group col">
                <label _log for="countTime">下次计费<i class="red">*</i></label>
                <input type="text" class="form-control" id="countTime" name="countTime" value="${boutiqueEntranceRecord.countTime!,localDateTimeFormat='yyyy-MM-dd HH:mm:ss'}" readonly />
            </div>

            <div class="form-group col">
                <label for="departmentId">接车部门</label>
                <select id="departmentId"  name="departmentId" class="form-control" readonly ></select>
                <#bcomboProvider _log="接车部门" _id="departmentId" _provider="carDepartmentProvider" _value="${boutiqueEntranceRecord.departmentId!}" />
            </div>

            <div class="form-group col">
                <label _log for="totalAmount">已交费<i class="red">*</i></label>
                <input type="text" class="form-control" id="totalAmount" name="totalAmount" value="${boutiqueEntranceRecord.totalAmount!}" readonly  />
            </div>

            <div class="form-group col">
                <label for="amount">精品停车费<i class="red">*</i></label>
                <input type="number" class="form-control floatReserve money" id="amount" name="amount" required/>
            </div>

            <div class="form-group col">
                <label for="costTime">费用时间</label>
                <input type="text" class="form-control" id="costTime" name="costTime" readonly/>
            </div>

            <div class="form-group col">
                <label for="notes">备注</label>
                <textarea id="notes" class="form-control" name="notes" rows="1" maxlength="100"></textarea>
            </div>
        </div>
        <div class="collapse show" id="details">
            <table class="table table-bordered table-hover table-striped" id="boothTable" >
                <thead>
                <tr>
                    <th style="font-weight:normal; ">缴费单号</th>
                    <th style="font-weight:normal; ">创建时间</th>
                    <th style="font-weight:normal; ">费用时间范围</th>
                    <th style="font-weight:normal; ">缴费金额/元</th>
                    <th style="font-weight:normal; ">备注</th>
                    <th style="font-weight:normal; ">状态</th>
                </tr>
                </thead>
                <tbody>
                <%
                if(boutiqueEntranceRecord.orderDtoList.~size>0){
                for(item in boutiqueEntranceRecord.orderDtoList){%>
                <tr>
                    <td>
                        ${item.code!'--'}
                    </td>

                    <td>
                        ${item.createTime!'--', localDateTimeFormat='yyyy-MM-dd HH:mm:ss'}
                    </td>
                    <td>
                        ${item.startTime!'--', localDateTimeFormat='yyyy-MM-dd HH:mm:ss'} - ${item.endTime!'--', localDateTimeFormat='yyyy-MM-dd HH:mm:ss'}
                    </td>
                    <td>
                        <#centToYuan value='${item.amount!0}'/>
                    </td>
                    <td>
                        ${item.notes!'--'}
                    </td>
                    <td>
                        ${@com.dili.ia.glossary.BoutiqueOrderStateEnum.getBoutiqueOrderStateEnumName(item.state!)}
                    </td>
                </tr>
                <% } } %>
                </tbody>
            </table>
        </div>

        <div class="text-right btn-r-b">
            <button type="button" class="btn btn-secondary px-5" onclick="javascript: parent.dia.hide()">取消</button>
            <button type="button" class="btn btn-primary px-5" onclick="bui.util.debounce(doSubmitHandler,1000,true)()" id="formSubmit">保存</button>
        </div>

    </form>
</div>

</#bs4Body>
<#js_customerAutocompleteJs/>
<#boutiqueEntranceRecord_preSaveJs/>

<script>
    $(()=>{
        endTimeFormat();
    })
    function endTimeFormat() {
        // 费用时间
        let countTime = $('#countTime').val();
        if (countTime != null && countTime != "") {
            let nowDate = new Date();
            let date3 = nowDate.getTime() - new Date(countTime).getTime();
            let days = Math.ceil(date3 / (24 * 3600 * 1000));
            // 将天数和下次计费时间相加
            let endTime =  moment(countTime).add('day', days).format('YYYY-MM-DD HH:mm:ss');

           $('#costTime').val(countTime + ' - ' + endTime);
           $('#endTime').val(endTime);
        }
    }
</script>


