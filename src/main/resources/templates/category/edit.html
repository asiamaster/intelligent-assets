<form id="editForm">
    <input type="hidden" id="updateForm_id" name="id" value="${obj.id!}"/>
    <div class="form-group row">
        <label for="code" class="col-sm-2 col-form-label">品类代码</label>
        <div class="col-sm-10">
            <input type="text" class="form-control" name="code" value="${obj.code!}" id="code" digits="true"
                   maxlength="12"/>
        </div>
    </div>
    <div class="form-group row">
        <label for="editForm_name" class="col-sm-2 col-form-label">品类名称</label>
        <div class="col-sm-10">
            <input type="text" id="editForm_name" name="name" class="form-control" maxlength="20" value="${obj.name!}"
                   required/>
        </div>
    </div>
    <div class="form-group row">
        <label for="editForm_pingying" class="col-sm-2 col-form-label">拼音全写</label>
        <div class="col-sm-10">
            <input type="text" id="editForm_pingying" name="pingying" class="form-control input-sm"
                   value="${obj.pingying!}"
                   maxlength="50"/>
        </div>
    </div>
    <div class="form-group row">
        <label for="editForm_pyInitials" class="col-sm-2 col-form-label">拼音简写</label>
        <div class="col-sm-10">
            <input type="text" id="editForm_pyInitials" name="pyInitials" class="form-control input-sm"
                   value="${obj.pyInitials!}"
                   maxlength="50"/>
        </div>
    </div>
</form>
<script type="text/javascript">
    $(function () {
        $("#editForm").validate();
        var okButton = $("#editBtn");
        okButton.unbind("click").click(function () {
            if ($("#editForm").valid()) {
                okButton.attr("disabled", "disabled");
                $.ajax({
                    type: "POST",
                    dataType: "json",
                    url: '/category/save.action',
                    data: $("#editForm").serialize(),
                    success: function (data) {
                        if (data.code != '200') {
                            tips("提示", data.message);
                            okButton.removeAttr("disabled");
                            return;
                        }
                        loadTable();
                        updateTreeNode(data.data);
                        $('#editModal').modal('hide');
                        tips("提示", "品类信息修改成功!");
                        okButton.removeAttr("disabled");
                    },
                    error: function () {
                        okButton.removeAttr("disabled");
                        tips("提示", "品类信息修改失败!");
                    }
                });
            }
        });

        $("#editForm_name").on("input", function () {
            var name = $("#editForm_name").val();
            if (name != undefined && name.trim() != '') {
                $.ajax({
                    type: "post",
                    url: '/category/convert.action',
                    dataType: "json",
                    data: {
                        'name': name
                    },
                    success: function (data) {
                        $("#editForm_pingying").val(data.whole);
                        $("#editForm_pyInitials").val(data.first);
                    },
                    error: function () {

                    }
                });
            } else {
                $("#editForm_pingying").val("");
                $("#editForm_pyInitials").val("");
            }
        });
    });
</script>