<#bs4Body>
<link href="https://cdn.bootcss.com/select2/4.0.12/css/select2.css" rel="stylesheet">
<script src="https://cdn.bootcss.com/select2/4.0.12/js/select2.min.js"></script>
<script src="https://cdn.bootcss.com/select2/4.0.12/js/i18n/zh-CN.js"></script>
<style>

    .boothname {
        text-indent: 20px;
    }
    tr[class*="treegrid-parent"] .boothname{
        text-indent: 40px;
    }

     .select2-container--default .select2-selection--single {
         border: 1px solid #DBDDE1;
         height: 33.5px;

     }
    .select2-container--default .select2-selection--single .select2-selection__rendered {
        line-height: 33.5px;
    }

    .select2-container--bootstrap4 .select2-selection--single {
        height: calc(2.25rem + 2px) !important
    }

    .select2-container--bootstrap4 .select2-selection--single .select2-selection__placeholder {
        color: #757575;
        line-height: 2.25rem
    }

    .select2-container--bootstrap4 .select2-selection--single .select2-selection__arrow {
        position: absolute;
        top: 50%;
        right: 3px;
        width: 20px
    }

    .select2-container--bootstrap4 .select2-selection--single .select2-selection__arrow b {
        top: 60%;
        border-color: #343a40 transparent transparent;
        border-style: solid;
        border-width: 5px 4px 0;
        width: 0;
        height: 0;
        left: 50%;
        margin-left: -4px;
        margin-top: -2px;
        position: absolute
    }

    .select2-container--bootstrap4 .select2-selection--single .select2-selection__rendered {
        line-height: 2.25rem
    }

    .select2-search--dropdown .select2-search__field {
        border: 1px solid #ced4da;
        border-radius: .25rem
    }

    .select2-results__message {
        color: #6c757d
    }

    .select2-container--bootstrap4 .select2-selection--multiple {
        min-height: calc(2.25rem + 2px) !important
    }

    .select2-container--bootstrap4 .select2-selection--multiple .select2-selection__rendered {
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        list-style: none;
        margin: 0;
        padding: 0 5px;
        width: 100%
    }

    .select2-container--bootstrap4 .select2-selection--multiple .select2-selection__choice {
        color: #343a40;
        border: 1px solid #bdc6d0;
        border-radius: .2rem;
        padding: 0 5px 0 0;
        cursor: pointer;
        float: left;
        margin-top: .3em;
        margin-right: 5px
    }

    .select2-container--bootstrap4 .select2-selection--multiple .select2-selection__choice__remove {
        color: #bdc6d0;
        font-weight: 700;
        margin-left: 3px;
        margin-right: 1px;
        padding-right: 3px;
        padding-left: 3px;
        float: left
    }

    .select2-container--bootstrap4 .select2-selection--multiple .select2-selection__choice__remove:hover {
        color: #343a40
    }

    .select2-container {
        display: block
    }

    .select2-container :focus {
        outline: 0
    }

    .input-group .select2-container--bootstrap4 {
        -webkit-box-flex: 1;
        -ms-flex-positive: 1;
        flex-grow: 1
    }

    .input-group-prepend ~ .select2-container--bootstrap4 .select2-selection {
        border-top-left-radius: 0;
        border-bottom-left-radius: 0
    }

    .input-group > .select2-container--bootstrap4:not(:last-child) .select2-selection {
        border-top-right-radius: 0;
        border-bottom-right-radius: 0
    }

    .select2-container--bootstrap4 .select2-selection {
        background-color: #fff;
        border: 1px solid #ced4da;
        border-radius: .25rem;
        -webkit-transition: border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;
        transition: border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;
        transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;
        transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;
        width: 100%
    }

    @media screen and (prefers-reduced-motion: reduce) {
        .select2-container--bootstrap4 .select2-selection {
            -webkit-transition: none;
            transition: none
        }
    }

    .select2-container--bootstrap4.select2-container--focus .select2-selection {
        border-color: #80bdff;
        -webkit-box-shadow: 0 0 0 .2rem rgba(0, 123, 255, .25);
        box-shadow: 0 0 0 .2rem rgba(0, 123, 255, .25)
    }

    .select2-container--bootstrap4.select2-container--focus.select2-container--open .select2-selection {
        border-bottom: none;
        border-bottom-left-radius: 0;
        border-bottom-right-radius: 0
    }

    .select2-container--bootstrap4.select2-container--disabled.select2-container--focus .select2-selection, .select2-container--bootstrap4.select2-container--disabled .select2-selection {
        background-color: #e9ecef;
        cursor: not-allowed;
        border-color: #ced4da;
        -webkit-box-shadow: none;
        box-shadow: none
    }

    .select2-container--bootstrap4.select2-container--disabled.select2-container--focus .select2-search__field, .select2-container--bootstrap4.select2-container--disabled .select2-search__field {
        background-color: transparent
    }

    form.was-validated select:invalid ~ .select2-container--bootstrap4 .select2-selection, select.is-invalid ~ .select2-container--bootstrap4 .select2-selection {
        border-color: #dc3545
    }

    form.was-validated select:valid ~ .select2-container--bootstrap4 .select2-selection, select.is-valid ~ .select2-container--bootstrap4 .select2-selection {
        border-color: #28a745
    }

    .select2-container--bootstrap4 .select2-dropdown {
        border-color: #ced4da;
        border-top: none;
        border-top-left-radius: 0;
        border-top-right-radius: 0
    }

    .select2-container--bootstrap4 .select2-dropdown.select2-dropdown--above {
        border-top: 1px solid #ced4da;
        border-top-left-radius: .25rem;
        border-top-right-radius: .25rem
    }

    .select2-container--bootstrap4 .select2-dropdown .select2-results__option[aria-selected=true] {
        background-color: #e9ecef
    }

    .select2-container--bootstrap4 .select2-results__option--highlighted, .select2-container--bootstrap4 .select2-results__option--highlighted.select2-results__option[aria-selected=true] {
        background-color: #007bff;
        color: #f8f9fa
    }

    .select2-container--bootstrap4 .select2-results__option[role=group] {
        padding: 0
    }

    .select2-container--bootstrap4 .select2-results > .select2-results__options {
        max-height: 15em;
        overflow-y: auto
    }

    .select2-container--bootstrap4 .select2-results__group {
        padding: 6px;
        display: list-item;
        color: #6c757d
    }

    .select2-container--bootstrap4 .select2-selection__clear {
        width: 1.2em;
        height: 1.2em;
        line-height: 1.15em;
        padding-left: .3em;
        margin-top: .5em;
        border-radius: 100%;
        background-color: #6c757d;
        color: #f8f9fa;
        float: right;
        margin-right: .3em
    }

    .select2-container--bootstrap4 .select2-selection__clear:hover {
        background-color: #343a40
    }
</style>
<div class="container-fluid">
    <#bs4nav>
    <form class="form collapse show" id="queryForm" role="form" >
        <div class="row  row-cols-6">
            <div class="form-group col">
                <label for="">摊位编号</label>
                <input type="text" class="form-control isNaturalNum" name="name" placeholder="">
            </div>
            <div class="form-group col">
                <label for="">部门</label>
                <select id="departmentId" name="departmentId" class="form-control w-200px"></select>
                <#bcomboProvider _id="departmentId" _provider="authDepartmentProvider" _queryParams='{emptyText:"-- 全部 --"}'/>
            </div>

            <div class="form-group col-4">
                <label for="">区域</label>
                <div class="input-group">
                    <select class="form-control" id="areaOneList" name="area" required>

                    </select>
                    <select class="form-control" id="areaTwoList" name="secondArea">
                        <option value="">-- 全部 --</option>
                    </select>
                </div>
            </div>
            <div class="form-group col">
                <label for="booth_status">状态</label>
                <select id="booth_status" class="form-control input-sm" name="state">
                    <option value="">-- 全部 --</option>
                    <option value="1">已启用</option>
                    <option value="2">已禁用</option>
                </select>
            </div>
            <div class="form-group col-auto">
                <label for="createdStart" class="justify-content-end mr-2 w-100px">创建时间:</label>
                <div class="form-inline">
                    <div class="input-group">
                        <input type="text" name="startTime" id="createdStart" class="form-control laydate date"/>
                        <div class="input-group-append">
                            <label for="createdStart" class="input-group-text fa fa-calendar"></label>
                        </div>
                    </div>&nbsp;&nbsp;至&nbsp;&nbsp;
                    <div class="input-group" id="datetimepicker3">
                        <input type="text" name="endTime" id="createdEnd" class="form-control laydate date" value=""/>
                        <div class="input-group-append">
                            <label for="createdEnd" class="input-group-text fa fa-calendar"></label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-group col-auto">
                <label for="">数量</label>
                <div class="form-inline">
                    <input type="number" name="startNumber" class="form-control" range="0 999999.00">
                    &nbsp;&nbsp;至&nbsp;&nbsp;
                    <input type="number" name="endNumber" class="form-control" range="0 999999.00">
                </div>
            </div>
            <div class="col align-self-center mt-3">
                <button type="button" class="btn btn-outline-primary mr-2" onclick="refresh()"><i class="fa fa-refresh"></i> 清空</button>
                <button type="button" class="btn btn-outline-primary" onclick="queryDataHandler()"><i class="fa fa-search"></i> 查询</button>
            </div>
        </div>

    </form>
</#bs4nav>


<div class="">
    <div class="row">
        <div class="col-12">
            <div id="toolbar" class="btn-group" role="group" aria-label="Toolbar with button groups">
                <#resource code="booth_view">
                <button type="button" class="btn btn-primary" onclick="openViewHandler()">
                    <i class="fa fa-eye"></i>查看
                </button>
                </#resource>
                <#resource code="booth_add">
                <button id="btn_add" type="button" class="btn btn-primary" onclick="openInsertHandler()"><i
                        class="fa fa-plus"></i> 新增
                </button>
                </#resource>
                <#resource code="booth_edit">
                <button type="button" class="btn btn-primary" onclick="openUpdateHandler()">
                    <i class="fa fa-pencil-square-o"></i> 修改
                </button>
                </#resource>
                <#resource code="booth_split">
                <button type="button" id="btn_split" class="btn btn-primary" onclick="openSplitHandler()">
                    <i class="fa fa-pencil-square-o"></i> 拆分摊位
                </button>
                </#resource>
                <#resource code="booth_del">
                <button type="button" class="btn btn-primary" onclick="openDeleteHandler()">
                    <i class="fa fa-trash-o"></i> 删除
                </button>
                </#resource>
                <#resource code="booth_on">
                <button type="button" class="btn btn-primary" onclick="doEnableHandler(1)">
                    <i class="fa fa-play"></i> 启用
                </button>
                </#resource>
                <#resource code="booth_off">
                <button type="button" class="btn btn-primary" onclick="doEnableHandler(2)">
                    <i class="fa fa-stop"></i> 禁用
                </button>
                </#resource>
            </div>
            <table id="grid" data-toggle="table" data-id-field="id" data-tree-show-field="name" data-parent-id-field="parentId" data-query-params="queryParams" data-sort-name="id"
                   data-sort-order="desc" data-pagination="true" data-page-number="1" data-page-size="10" data-side-pagination="server" data-single-select="true" data-click-to-select="true" data-ignore-click-to-select-on="ignoreExpandClick">
                <thead>
                <tr>
                    <th data-formatter="emptyFormatter" data-width="36" data-align="center" class="expandicon"></th>
                    <th data-radio="true"></th>
                    <th data-field="name" data-align="left" data-sortable="true" data-formatter="formatterView" data-class="boothname">
                        摊位编号
                    </th>
                    <th data-field="number" data-align="center" data-sortable="true">
                        数量
                    </th>
                    <th data-field="unit" data-align="center" data-provider="dataDictionaryValueProvider" data-sortable="true">
                        单位
                    </th>
                    <th data-field="area" data-align="center" data-provider="districtProvider" data-sortable="true">
                        区域
                    </th>
                    <th data-field="departmentId" data-align="center" data-provider="departmentProvider" data-sortable="true" data-sort-name="department_id">
                        部门
                    </th>
                    <th data-field="createTime" data-align="center" data-sort-name="create_time"
                        data-provider="datetimeProvider" data-sortable="true">
                        创建时间
                    </th>
                    <th data-field="state" data-align="center" data-provider="boothStateProvider" data-sortable="true">
                        状态
                    </th>
                </tr>
                </thead>
            </table>
        </div>
    </div>
</div>


</div>

</#bs4Body>
<#btreegrid/>
<div class="modal fade" id="_modal" data-backdrop="static" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
    <!--modal-lg modal-sm(默认) 通过设置mw大小调整宽度（如mw-100） modal-dialog-centered垂直居中-->
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <!-- 标题 -->
                <h5 class="modal-title" id="exampleModalLabel">客户新增</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
            </div>
        </div>
    </div>
</div>
<script>



    var hasEdit = false;
    var hasDel = false;
    var hasSplit = false;
    var hasView = false;
    var hasOn = false;
    var hasOff = false;
    <#resource code="booth_edit">
    hasEdit = true;
    </#resource>
    <#resource code="booth_del">
    hasDel = true;
    </#resource>
    <#resource code="booth_split">
    hasSplit = true;
    </#resource>
    <#resource code="booth_view">
    hasView = true;
    </#resource>
    <#resource code="booth_on">
    hasOn = true;
    </#resource>
    <#resource code="booth_off">
    hasOff = true;
    </#resource>
</script>
<script>
    var itemIndex = 0;

    function operateFormatter(value, row, index) {
        var split = ['<a class="like" href="javascript:void(0)" onclick="openSplitHandler(' + row.id + ')" title="Like">',
            '拆分摊位',
            '</a>  '];
var view = ' <a class="like" href="javascript:void(0)" onclick="openViewHandler(' + row.id + ')" title="Like">查看</a>';
var edit = ' <a class="like" href="javascript:void(0)" onclick="openUpdateHandler(' + row.id + ')" title="Like">修改</a>';
var del = ' <a class="remove" href="javascript:void(0)" onclick="openDeleteHandler(' + row.id + ')" title="Remove">删除</a>';
var on = ' <a class="remove" href="javascript:void(0)" onclick="doEnableHandler(1,' + row.id + ')" title="Remove">启用</a>';
var off = ' <a class="remove" href="javascript:void(0)" onclick="doEnableHandler(2,' + row.id + ')" title="Remove">禁用</a>';
        var oprate = '';
        if(hasView){
            oprate+=view;
        }
        if(hasEdit){
            oprate+=edit;
        }
        if(hasDel){
            oprate+=del;
        }
        if(hasOn){
            oprate+=on;
        }
        if(hasOff){
            oprate+=off;
        }
        if (row.parentId === 0 && hasSplit ) {
            return split.join("") + oprate;
        } else {
            return oprate;
        }
    }

    function emptyFormatter(){return ''}

    function formatterView(value, row, index) {
        if(hasView){
            return '<a class="like" href="javascript:void(0)" onclick="openViewHandler(' + row.id + ')" title="Like">' + value + '</a>'
        }else{
            return row.name;
        }
    }

    function refresh() {
        $('#queryForm .form-control').val('');
        $('#areaOneList').html("");
        $.ajax({
            type: "POST",
            url: "/district/search.action",
            data: {parentId: 0},
            success: function (data) {
                if (data.code == "200") {
                    var array = [];
                    array.push({text:"-- 全部 --",id:""});
                    var data = $.map(data.data, function (obj) {
                        obj.text = obj.text || obj.name;
                        return obj;
                    });
                    for (var x in data) {
                        array.push(data[x]);
                    }
                    if (data.length == 0) {
                        $('#areaOneList').html("");
                        $('#areaTwoList').html("");
                    } else {
                        $("#areaOneList").select2({
                            data: array,
                            language:'zh-CN',
                            width: "50%",
                            minimumResultsForSearch: Infinity
                        });
                    }
                }
            }
        });

        $.ajax({
            type: "POST",
            url: "/district/search.action",
            data: {parentId: -1},
            success: function (data) {
                if (data.code == "200") {
                    var array = [];
                    array.push({text:"-- 全部 --",id:""});
                    var data = $.map(data.data, function (obj) {
                        obj.text = obj.text || obj.name;
                        return obj;
                    });
                    for (var x in data) {
                        array.push(data[x]);
                    }
                    $('#areaTwoList').html("")
                    $("#areaTwoList").select2({
                        language: 'zh-CN',
                        data: array,
                        width: "50%",
                        minimumResultsForSearch: Infinity
                    })
                }
            }
        });
    }

    function ignoreExpandClick(e) {
        return ['SPAN'].indexOf(e.tagName) > -1;
    }

</script>

<#booth_indexJs />