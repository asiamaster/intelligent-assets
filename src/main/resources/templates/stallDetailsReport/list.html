<#bs4Body>

<div class="container-fluid">
    <#bs4nav>
    <form class="form collapse show" id="queryForm" role="form">
        <div class="row  row-cols-6">
            <div class="form-group col">
                <label for="">摊位编号</label>
                <#bautoCompleteProvider _hiddenDomainClass="form-control" _hiddenDomainId="id" _hiddenDomainName="id"
                _displayDomainId="_id" _displayDomainName="_id" _placeholder="" _provider="stallProvider"
                _validatorMethod="isSelected" _value="" _text="" _required="true"/>
            </div>
            <div class="form-group col">
                <label for="">一级区域</label>
                <select id="firstDistrictId" name="firstDistrictId" class="form-control"
                        onchange="serachSec(value)"></select>
                <#bcomboProvider _id="firstDistrictId" _provider="firstDistrictProvider" _value=""
                _queryParams='{emptyText:"-- 全部 --"}'/>
            </div>
            <div class="form-group col">
                <label for="">二级区域</label>
                <select id="secDistrict" name="secDistrictId" class="form-control">

                </select>
            </div>
            <div class="form-group col">
                <label for="">是否结清</label>
                <select name="payState" class="form-control">
                    <option value="">--全部--</option>
                    <option value="2">已结清</option>
                    <option value="1">未结清</option>
                </select>
            </div>
        </div>
        <div class="row  row-cols-6">
            <div class="form-group col-auto">
                <label for="">查询日期</label>
                <div class="form-inline">
                    <div class="input-group">
                        <input type="text" name="searchDate" id="createdStart"
                               class="form-control laydatetime laystart"/>
                        <div class="input-group-append">
                            <label for="" class="input-group-text fa fa-calendar"></label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-group col">
                <label for="">摊位状态</label>
                <select id="" name="isLeseStatus" class="form-control">
                    <option value="">--全部--</option>
                    <option value="2">已出租</option>
                    <option value="3">未出租</option>
                </select>
            </div>
            <div class="col align-self-center mt-3">
                <button type="button" class="btn btn-outline-primary mr-2"
                        onclick="javascript:$('#queryForm .form-control').val('');"><i class="fa fa-refresh"></i> 清空
                </button>
                <button type="button" class="btn btn-outline-primary" onclick="queryDataHandler()"><i
                        class="fa fa-search"></i> 查询
                </button>
            </div>
        </div>
    </form>
</#bs4nav>


<div class="">
    <div class="row">
        <div class="col-12">
            <button id="btn_view" type="button" class="btn btn-primary" onclick="openViewHandler()"><i class="fa fa-eye"></i> 订单详情</button>
            <button id="export" type="button" class="btn btn-primary" onclick="bui.util.doExport('grid','queryForm')"><i class="fa fa-download"></i> 导出</button>
        </div>
            <table id="grid" data-toggle="table" data-id-field="id" data-title="转离场结算单列表" data-tree-show-field="name"
                   data-parent-id-field="parentId" data-query-params="queryParams" data-sort-name="id"
                   data-sort-order="desc" data-pagination="true" data-page-number="1" data-page-size="10"
                   data-side-pagination="server" data-single-select="true" data-click-to-select="true"
                   data-ignore-click-to-select-on="ignoreExpandClick">
                <thead>
                <tr>
                    <th data-field="assetsName" data-align="center" data-sortable="true" rowspan="2">
                        摊位编号
                    </th>
                    <th data-field="startTime" data-align="center" data-provider="datetimeProvider" data-sortable="true" rowspan="2">
                        开始日期
                    </th>
                    <th data-field="endTime" data-align="center" data-provider="datetimeProvider" data-sortable="true" rowspan="2">
                        结束日期
                    </th>
                    <th data-field="firstDistrictName" data-align="center" data-sortable="true" rowspan="2">
                        一级区域
                    </th>
                    <th data-field="secDistrictName" data-align="center" data-sortable="true" rowspan="2">
                        二级区域
                    </th>
                    <th data-field="number" data-align="center" data-sortable="true" rowspan="2">
                        数量
                    </th>
                    <th data-field="unit" data-align="center" data-sortable="true" rowspan="2">
                        单位
                    </th>
                    <th data-field="corner" data-provider="cornerProvider" data-align="center" data-sortable="true" rowspan="2">
                        是否转角
                    </th>
                    <th data-align="center" colspan="2">
                        保证金
                    </th>
                    <%if(isNotEmpty(chargeItems) && chargeItems.~size>0){
                    for(item in chargeItems){
                    %>
                    <th data-align="center" colspan="2">
                        ${item.chargeItem!}
                    </th>
                    <% } }%>
                    <th data-field="payState" data-provider="payStateProvider" data-align="center" data-sortable="true" rowspan="2">
                        是否结清
                    </th>
                    <th data-field="code" data-align="center" data-sortable="true" rowspan="2">
                        业务单号
                    </th>
                    <th data-field="totalAmount" data-align="center" data-sortable="true" rowspan="2">
                        订单金额
                    </th>
                    <th data-field="paidAmount" data-align="center" data-sortable="true" rowspan="2">
                        已付金额
                    </th>
                    <th data-field="isLease" data-align="center" data-sortable="true" rowspan="2">
                        状态
                    </th>
                </tr>
                <tr>
                    <th data-field="amount" data-align="center" data-sortable="true">
                        保证金应交
                    </th>
                    <th data-field="balance" data-align="center" data-sortable="true">
                        保证金已交
                    </th>
                    <%if(isNotEmpty(chargeItems) && chargeItems.~size>0){
                    for(item in chargeItems){
                    %>
                    <th data-field="businessChargeItem.chargeItemAmount${item.id!}" data-sortable="true" data-align="center">
                        应交
                    </th>
                    <th data-field="businessChargeItem.chargeItemPaid${item.id!}" data-sortable="true" data-align="center">
                        已交
                    </th>
                    <% } }%>
                </tr>
                </thead>
            </table>
        </div>
    </div>
</div>


</div>

</#bs4Body>

<script>
    function serachSec(value) {
        let targetId = $('#secDistrict');
        targetId.empty();
        let datas = ["<option value=''>" + '-- 请选择 --' + "</option>"];
        $.ajax({
            type: "POST",
            url: "/stallDetailsReport/serachSec.action",
            data: {"id": value},
            async: true,
            success: function (res) {
                bui.loading.hide();
                if (res.code == "200") {
                    $.each(res.data, function (i, item) {
                        datas.push('<option value="' + item.id + '">' + item.name + '</option>');
                    });
                } else {
                    bs4pop.alert(res.result, {type: 'error'});
                }
            },
            error: function (error) {
                bs4pop.alert(error.result, {type: 'error'});
            }
        });
        targetId.html(datas.join(''));
    }


</script>
<#stallDetailsReport_indexJs />